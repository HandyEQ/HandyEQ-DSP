%% TO BE COMPLETED - NOT DONE!

%% Testbench for fixed point IIR filter.
%   Uses coefficients generated by eq_coeffgen3band.m (stage1)
% Dependencies: 
%   - responseanalysis.m
%   - directform1biquad.m

%   By enabling different options below, this script can:
%   - Plot signals through IIR filter incl accumulators
%   - Plot output response
%   - Input audio file through filter
%   - Play back output audio
%   - Save output audio to audio file.
%   - Plot frequency response based on FFT of impulseresponse

%Working notes:
%!! Fs system og Fs audiofile can be different, should be fixed!


%% Input parameters:
stage1index = 2;        % stage1.{stage1index} choose coefficient set in array(cell)
stage2index = 5;
stage3index = 5;

plotimpulse = 1;

%% Create impulse signal
impulselength = 1000;
impulseonevalue = 16384;
impulsesignal = zeros(impulselength, 'int32');
impulsesignal(1) = impulseonevalue;

%% Run stage1
[outputresponsestage1, ~] = directform1biquad(impulsesignal,stage1{stage1index});

scrsz = get(0,'ScreenSize');    
fig_response1 = figure('Name','Measured response from stage1','Position',[scrsz(3)/2 scrsz(4)/2 scrsz(3)/2 scrsz(4)/2-78]);  
%%Run FFT and plot:
responseanalysis(outputresponsestage1,impulseonevalue,Fs,plotimpulse);

